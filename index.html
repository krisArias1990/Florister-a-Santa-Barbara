<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Florister√≠a Santa B√°rbara: arreglos florales para todas las ocasiones en Heredia, Costa Rica. Pedidos por WhatsApp con cat√°logo digital.">
    <meta name="keywords" content="flores, arreglos florales, Heredia, Costa Rica, rosas, tulipanes, entrega a domicilio, florister√≠a">
    <title>Florister√≠a Santa B√°rbara - Flores Frescas a Domicilio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --primary: #e91e63;
            --primary-dark: #c2185b;
            --secondary: #9c27b0;
            --success: #4caf50;
            --info: #2196f3;
            --warning: #ff9800;
            --danger: #f44336;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border: #dee2e6;
            --shadow: 0 5px 15px rgba(0,0,0,0.08);
            --shadow-hover: 0 10px 25px rgba(0,0,0,0.12);
            --transition: all 0.3s ease;
            --radius: 12px;
            --radius-sm: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }
        
        ul {
            list-style: none;
        }
        
        button, input, textarea, select {
            font-family: 'Open Sans', sans-serif;
        }
        
        button {
            cursor: pointer;
            border: none;
            outline: none;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ===== HEADER PROFESIONAL ===== */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            font-size: 2rem;
            color: white;
        }
        
        .logo h1 {
            font-size: 1.6rem;
            margin: 0;
            color: white;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            color: white;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            font-size: 1rem;
        }
        
        .nav-links a:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .cart-btn {
            background: rgba(255,255,255,0.15);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .cart-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }
        
        .cart-count {
            background: var(--warning);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
        }
        
        .admin-btn {
            background: var(--warning);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .admin-btn:hover {
            background: #e68900;
            transform: translateY(-2px);
        }
        
        /* ===== BANNER PRINCIPAL ===== */
        .banner-floristeria {
            width: 100%;
            margin-bottom: 3rem;
            border-radius: 0 0 var(--radius) var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .banner-flor-img {
            width: 100%;
            height: auto;
            display: block;
            max-height: 400px;
            object-fit: cover;
        }
        
        /* ===== CARRUSEL HERO ===== */
        .carousel-section {
            padding: 0 0 3rem;
        }
        
        .carousel {
            position: relative;
            max-width: 900px;
            margin: 0 auto;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .carousel-inner {
            display: flex;
            transition: transform 0.5s ease;
        }
        
        .carousel-item {
            min-width: 100%;
            position: relative;
        }
        
        .carousel-img {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }
        
        .carousel-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .carousel-caption h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: white;
        }
        
        .carousel-controls {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            padding: 0 20px;
        }
        
        .carousel-prev, .carousel-next {
            background: rgba(255,255,255,0.9);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            color: var(--dark);
            transition: var(--transition);
        }
        
        .carousel-prev:hover, .carousel-next:hover {
            background: white;
            transform: scale(1.1);
        }
        
        .carousel-indicators {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .carousel-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .carousel-indicator.active {
            background: white;
            transform: scale(1.2);
        }
        
        /* ===== BARRA DE CONTACTO ===== */
        .contact-bar {
            background: var(--dark);
            color: white;
            padding: 1rem 0;
            font-size: 0.95rem;
        }
        
        .contact-info {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .contact-item i {
            color: var(--primary);
        }
        
        /* ===== CAT√ÅLOGO PROFESIONAL ===== */
        .catalog-section {
            padding: 3rem 0;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-title {
            font-size: 2.5rem;
            color: var(--dark);
            margin-bottom: 1rem;
        }
        
        .section-subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Filtros de Categor√≠a */
        .category-filters {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
        }
        
        .category-btn {
            background: white;
            border: 2px solid var(--border);
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
        }
        
        .category-btn:hover, .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* Grid de Productos */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }
        
        /* Tarjeta de Producto Profesional */
        .product-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-hover);
        }
        
        .product-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1;
        }
        
        .product-image-container {
            position: relative;
            overflow: hidden;
            height: 220px;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
            cursor: pointer;
        }
        
        .product-image:hover {
            transform: scale(1.05);
        }
        
        .product-info {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-category {
            color: var(--primary);
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .product-title {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: var(--dark);
            line-height: 1.3;
        }
        
        .product-description {
            color: var(--gray);
            font-size: 0.95rem;
            margin-bottom: 1rem;
            flex-grow: 1;
            line-height: 1.5;
        }
        
        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 1.25rem;
        }
        
        .add-to-cart-btn {
            background: var(--primary);
            color: white;
            width: 100%;
            padding: 12px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 1rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .add-to-cart-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .add-to-cart-btn.added {
            background: var(--success);
        }
        
        /* ===== MODAL DE IMAGEN AMPLIADA ===== */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .image-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .image-modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }
        
        .modal-image {
            width: 100%;
            height: auto;
            max-height: 80vh;
            object-fit: contain;
            border-radius: var(--radius-sm);
        }
        
        .close-modal-btn {
            position: absolute;
            top: -50px;
            right: 0;
            background: var(--danger);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .close-modal-btn:hover {
            background: #d32f2f;
            transform: rotate(90deg);
        }
        
        /* ===== MODAL DEL CARRITO ===== */
        .cart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1500;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .cart-modal.active {
            display: flex;
        }
        
        .cart-modal-content {
            background: white;
            width: 100%;
            max-width: 800px;
            border-radius: var(--radius);
            overflow: hidden;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .cart-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-header h3 {
            margin: 0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-cart-btn {
            background: none;
            color: white;
            font-size: 1.8rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .close-cart-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .cart-body {
            padding: 1.5rem;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .cart-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray);
        }
        
        .cart-empty i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray-light);
        }
        
        .cart-items {
            margin-bottom: 1.5rem;
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
            gap: 15px;
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: var(--radius-sm);
        }
        
        .cart-item-details {
            flex-grow: 1;
        }
        
        .cart-item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .cart-item-price {
            color: var(--success);
            font-weight: 700;
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            background: white;
            border: 1px solid var(--border);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .quantity-btn:hover {
            background: var(--light);
        }
        
        .item-quantity {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }
        
        .remove-item-btn {
            background: var(--danger);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .remove-item-btn:hover {
            background: #d32f2f;
        }
        
        /* Formulario del Pedido */
        .order-form {
            background: var(--light);
            padding: 1.5rem;
            border-radius: var(--radius-sm);
            margin-top: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(233,30,99,0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 0.5rem;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        /* Mapa de Ubicaci√≥n */
        #map {
            height: 300px;
            width: 100%;
            border-radius: var(--radius-sm);
            margin-top: 10px;
            border: 2px solid var(--border);
        }
        
        .map-instructions {
            background: #f0f8ff;
            padding: 10px;
            border-radius: var(--radius-sm);
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .map-instructions i {
            color: var(--info);
            margin-right: 5px;
        }
        
        /* M√©todos de Pago */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 0.5rem;
        }
        
        .payment-method {
            background: white;
            border: 2px solid var(--border);
            padding: 12px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-method:hover {
            border-color: var(--primary);
        }
        
        .payment-method.selected {
            border-color: var(--primary);
            background: rgba(233,30,99,0.05);
        }
        
        .payment-icon {
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        /* Resumen del Pedido */
        .order-summary {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-sm);
            margin-top: 1.5rem;
            border: 2px solid var(--border);
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            font-size: 1.05rem;
        }
        
        .summary-total {
            border-top: 2px solid var(--border);
            padding-top: 0.75rem;
            margin-top: 0.75rem;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--success);
        }
        
        .cart-footer {
            padding: 1.5rem;
            background: var(--light);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 14px 25px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 1rem;
            transition: var(--transition);
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-secondary {
            background: var(--gray);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #25D366;
            color: white;
        }
        
        .btn-success:hover {
            background: #1da851;
            transform: translateY(-2px);
        }
        
        /* ===== FOOTER PROFESIONAL ===== */
        .footer {
            background: var(--dark);
            color: white;
            padding: 3rem 0 2rem;
            margin-top: 4rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 2rem;
        }
        
        .footer-section h3 {
            color: white;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-section h3:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--primary);
        }
        
        .footer-section ul li {
            margin-bottom: 0.75rem;
        }
        
        .footer-section ul li a {
            color: #ccc;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .footer-section ul li a:hover {
            color: white;
            padding-left: 5px;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 1.5rem;
        }
        
        .social-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: var(--transition);
        }
        
        .social-icon:hover {
            background: var(--primary);
            transform: translateY(-3px);
        }
        
        .map-links {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
        }
        
        .map-btn {
            background: var(--info);
            color: white;
            padding: 8px 15px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .map-btn:hover {
            background: #0d8bf2;
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* ===== WHATSAPP FLOTANTE ===== */
        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #25D366;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
            z-index: 1000;
            transition: var(--transition);
            text-decoration: none;
        }
        
        .whatsapp-float:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(37, 211, 102, 0.4);
        }
        
        /* ===== NOTIFICACIONES ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 992px) {
            .nav-links {
                gap: 15px;
            }
            
            .logo h1 {
                font-size: 1.4rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .carousel-img {
                height: 350px;
            }
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-links {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
            
            .header-actions {
                order: 2;
            }
            
            .contact-info {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .cart-modal-content {
                max-height: 95vh;
            }
            
            .carousel-controls {
                padding: 0 10px;
            }
            
            .carousel-prev, .carousel-next {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .whatsapp-float {
                bottom: 20px;
                right: 20px;
                width: 55px;
                height: 55px;
                font-size: 1.8rem;
            }
        }
        
        @media (max-width: 576px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .category-filters {
                gap: 10px;
            }
            
            .category-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .payment-methods {
                grid-template-columns: 1fr;
            }
            
            .cart-footer {
                flex-direction: column;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }
        
        /* ===== ANIMACIONES ===== */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* ===== ESTADOS DE CARGA ===== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ===== UTILIDADES ===== */
        .text-center { text-align: center; }
        .text-primary { color: var(--primary); }
        .text-success { color: var(--success); }
        .text-muted { color: var(--gray); }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-3 { margin-top: 1.5rem; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <!-- Header Profesional -->
    <header class="header">
        <div class="container">
            <div class="nav-container">
                <a href="#" class="logo">
                    <i class="fas fa-spa logo-icon"></i>
                    <h1>Florister√≠a Santa B√°rbara</h1>
                </a>
                
                <ul class="nav-links">
                    <li><a href="#inicio">Inicio</a></li>
                    <li><a href="#catalogo">Cat√°logo</a></li>
                    <li><a href="#contacto">Contacto</a></li>
                </ul>
                
                <div class="header-actions">
                    <button class="cart-btn" onclick="openCart()">
                        <i class="fas fa-shopping-cart"></i>
                        Carrito <span class="cart-count">0</span>
                    </button>
                    <a href="admin.html" target="_blank" class="admin-btn">
                        <i class="fas fa-user-cog"></i>
                        Panel Admin
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Banner Principal -->
    <section class="banner-floristeria">
        <img src="https://raw.githubusercontent.com/krisArias1990/Florister-a-Santa-B-rbara/main/assets/banner_floristeria.jpeg" 
             alt="Florister√≠a Santa B√°rbara" class="banner-flor-img">
    </section>

    <!-- Carousel Hero -->
    <section class="carousel-section" id="inicio">
        <div class="container">
            <div class="carousel">
                <div class="carousel-inner" id="carousel-inner"></div>
                <div class="carousel-indicators" id="carousel-indicators"></div>
                <div class="carousel-controls">
                    <button class="carousel-prev" onclick="prevSlide()">‚ùÆ</button>
                    <button class="carousel-next" onclick="nextSlide()">‚ùØ</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Barra de Contacto -->
    <section class="contact-bar">
        <div class="container">
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>Tel: (506) 8605-3613</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Santa B√°rbara, Heredia, Costa Rica</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-clock"></i>
                    <span>Lunes a S√°bado: 8am - 7pm</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Cat√°logo de Productos -->
    <section class="catalog-section" id="catalogo">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Nuestros Arreglos Florales</h2>
                <p class="section-subtitle">Selecciona entre nuestra variedad de flores frescas para cada ocasi√≥n especial</p>
            </div>

            <!-- Filtros de Categor√≠a -->
            <div class="category-filters" id="categoryFilters"></div>

            <!-- Grid de Productos -->
            <div class="products-grid" id="productsGrid">
                <!-- Los productos se cargan din√°micamente -->
            </div>
        </div>
    </section>

    <!-- Modal de Imagen Ampliada -->
    <div class="image-modal" id="imageModal">
        <div class="image-modal-content">
            <img src="" alt="Vista ampliada" class="modal-image" id="modalImage">
            <button class="close-modal-btn" onclick="closeImageModal()">√ó</button>
        </div>
    </div>

    <!-- Modal del Carrito -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-modal-content">
            <div class="cart-header">
                <h3><i class="fas fa-shopping-cart"></i> Completar Tu Pedido</h3>
                <button class="close-cart-btn" onclick="closeCart()">√ó</button>
            </div>

            <div class="cart-body">
                <div id="cartItemsContainer">
                    <!-- Los items del carrito se cargan aqu√≠ -->
                </div>

                <div class="order-form" id="orderForm">
                    <h4 class="form-label"><i class="fas fa-user"></i> Informaci√≥n del Cliente</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nombre completo *</label>
                            <input type="text" id="customerName" class="form-control" placeholder="Tu nombre" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tel√©fono *</label>
                            <input type="tel" id="customerPhone" class="form-control" placeholder="8888-8888" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">¬øC√≥mo prefieres recibir tu pedido? *</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="deliveryType" value="delivery" checked>
                                <span>Env√≠o a domicilio</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="deliveryType" value="pickup">
                                <span>Recoger en tienda</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group" id="addressField">
                        <label class="form-label">Direcci√≥n exacta para env√≠o *</label>
                        <textarea id="deliveryAddress" class="form-control" rows="2" 
                                  placeholder="Direcci√≥n completa, puntos de referencia..." required
                                  oninput="calculateShippingFromAddress()"></textarea>
                        
                        <div class="map-instructions" id="mapInstructions">
                            <i class="fas fa-info-circle"></i>
                            El costo de env√≠o se calcula autom√°ticamente: ‚Ç°650 por kil√≥metro desde nuestra ubicaci√≥n.
                        </div>
                        
                        <!-- Mapa para mostrar ubicaci√≥n -->
                        <div id="map"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fecha de entrega *</label>
                            <input type="date" id="deliveryDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Horario de entrega *</label>
                            <select id="deliveryTime" class="form-control" required>
                                <option value="">Seleccionar horario</option>
                                <option value="Ma√±ana (8:00 AM - 12:00 PM)">Ma√±ana (8:00 AM - 12:00 PM)</option>
                                <option value="Tarde (1:00 PM - 6:00 PM)">Tarde (1:00 PM - 6:00 PM)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">M√©todo de Pago *</label>
                        <div class="payment-methods">
                            <div class="payment-method" onclick="selectPayment('sinpe')">
                                <i class="fas fa-mobile-alt payment-icon"></i>
                                <span>SINPE M√≥vil</span>
                            </div>
                            <div class="payment-method" onclick="selectPayment('efectivo')">
                                <i class="fas fa-money-bill-wave payment-icon"></i>
                                <span>Efectivo</span>
                            </div>
                            <div class="payment-method" onclick="selectPayment('tarjeta')">
                                <i class="fas fa-credit-card payment-icon"></i>
                                <span>Tarjeta</span>
                            </div>
                            <div class="payment-method" onclick="selectPayment('transferencia')">
                                <i class="fas fa-university payment-icon"></i>
                                <span>Transferencia</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notas adicionales (opcional)</label>
                        <textarea id="orderNotes" class="form-control" rows="3" 
                                  placeholder="Instrucciones especiales, detalles del regalo, etc."></textarea>
                    </div>

                    <div style="background: #f0f8ff; padding: 15px; border-radius: var(--radius-sm); margin-top: 20px; border-left: 4px solid var(--info);">
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 8px;">
                            <strong>üì± SINPE M√≥vil:</strong> 8605-3613
                        </p>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 8px;">
                            <strong>üè¶ Transferencia:</strong> BAC | 123456789
                        </p>
                        <p style="color: #666; font-size: 0.9rem;">
                            <strong>‚è∞ Confirmaci√≥n:</strong> Nos comunicaremos lo m√°s pronto posible.
                        </p>
                    </div>
                </div>

                <div class="order-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="cartSubtotal">‚Ç°0</span>
                    </div>
                    <div class="summary-row">
                        <span>Costo de env√≠o:</span>
                        <span id="cartShipping">‚Ç°0</span>
                        <small id="shippingDistance" style="font-size: 0.8rem; color: var(--gray);"></small>
                    </div>
                    <div class="summary-row summary-total">
                        <span>Total a pagar:</span>
                        <span id="cartTotal">‚Ç°0</span>
                    </div>
                </div>
            </div>

            <div class="cart-footer">
                <button class="btn btn-secondary" onclick="closeCart()">
                    <i class="fas fa-arrow-left"></i>
                    Seguir comprando
                </button>
                <button class="btn btn-danger" onclick="clearCart()" style="background: var(--danger);">
                    <i class="fas fa-trash"></i>
                    Vaciar Carrito
                </button>
                <button class="btn btn-success" onclick="sendWhatsAppOrder()">
                    <i class="fab fa-whatsapp"></i>
                    Enviar pedido por WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="contacto">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-spa"></i> Florister√≠a Santa B√°rbara</h3>
                    <p>Flores frescas y arreglos florales para toda ocasi√≥n. Calidad y elegancia en cada detalle.</p>
                    <div class="social-icons">
                        <a href="https://www.facebook.com/share/19t8Z9fFwM/" class="social-icon" target="_blank">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://www.instagram.com/floristsantabarbara" class="social-icon" target="_blank">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://www.tiktok.com/@florist.santabarbara" class="social-icon" target="_blank">
                            <i class="fab fa-tiktok"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3><i class="fas fa-map-marker-alt"></i> Ubicaci√≥n</h3>
                    <p>Santa B√°rbara, Heredia, Costa Rica</p>
                    <div class="map-links">
                        <a href="https://waze.com/ul?q=Florister√≠a%20Santa%20B√°rbara%20Heredia%20Costa%20Rica" 
                           class="map-btn" target="_blank">
                            <i class="fab fa-waze"></i> Waze
                        </a>
                        <a href="https://maps.google.com/maps?q=Florister√≠a+Santa+B√°rbara+Heredia+Costa+Rica" 
                           class="map-btn" target="_blank">
                            <i class="fas fa-map-marked-alt"></i> Google Maps
                        </a>
                    </div>
                    <div style="margin-top: 15px;">
                        <p><i class="fas fa-phone"></i> Tel: (506) 8605-3613</p>
                        <p><i class="fas fa-envelope"></i> ventas@floristeriasantabarbara.com</p>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3><i class="fas fa-clock"></i> Horarios</h3>
                    <ul>
                        <li><strong>Lunes a Viernes:</strong> 8:00 AM - 7:00 PM</li>
                        <li><strong>S√°bados:</strong> 8:00 AM - 7:00 PM</li>
                        <li><strong>Domingos:</strong> Cerrado</li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3><i class="fas fa-credit-card"></i> M√©todos de Pago</h3>
                    <ul>
                        <li><i class="fas fa-mobile-alt"></i> SINPE M√≥vil</li>
                        <li><i class="fas fa-money-bill-wave"></i> Efectivo</li>
                        <li><i class="fas fa-credit-card"></i> Tarjetas</li>
                        <li><i class="fas fa-university"></i> Transferencia</li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>¬© 2024 Florister√≠a Santa B√°rbara. Todos los derechos reservados.</p>
                <p style="margin-top: 5px; font-size: 0.8rem;">
                    Desarrollado con <i class="fas fa-heart" style="color: var(--primary);"></i> para tu negocio
                </p>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Float -->
    <a href="https://wa.me/50686053613?text=¬°Hola!%20Me%20gustar√≠a%20informaci√≥n%20sobre%20sus%20flores" 
       class="whatsapp-float" target="_blank" id="whatsappFloat">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Producto agregado al carrito</span>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ============================================
        // SISTEMA PRINCIPAL - FLORISTER√çA SANTA B√ÅRBARA
        // ============================================

        // Variables globales
        let cart = JSON.parse(localStorage.getItem('floristeria_cart')) || [];
        let products = [];
        let categories = JSON.parse(localStorage.getItem('floristeria_categories')) || [];
        let storeConfig = JSON.parse(localStorage.getItem('floristeria_config')) || {
            storeName: "Florister√≠a Santa B√°rbara",
            phoneNumber: "50686053613",
            shippingCostPerKm: 650,
            currency: "‚Ç°",
            whatsappMessage: "¬°Hola! üòä\n\nGracias por comunicarte con Florister√≠a Santa B√°rbara. En un momento te atendemos.üòäüåπ \n\nQuiero hacer un pedido:",
            address: "Santa B√°rbara, Heredia, Costa Rica"
        };

        let selectedPayment = 'sinpe';
        let currentCarouselSlide = 0;
        let map = null;
        let storeLocation = null;
        let customerLocation = null;
        let distanceKm = 0;

        // ============================================
        // INICIALIZACI√ìN
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos centralizados
            loadStoreData();
            
            // Inicializar componentes
            initCarousel();
            loadCategories();
            loadProducts();
            updateCartCount();
            setupEventListeners();
            
            // Configurar fecha m√≠nima (ma√±ana)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('deliveryDate').min = tomorrow.toISOString().split('T')[0];
            document.getElementById('deliveryDate').value = tomorrow.toISOString().split('T')[0];
            
            // Inicializar mapa
            initMap();
            
            // Seleccionar SINPE por defecto
            selectPayment('sinpe');
            
            // Verificar actualizaciones cada 5 minutos
            setInterval(checkForUpdates, 5 * 60 * 1000);
        });

        function loadStoreData() {
            console.log("üì• Cargando datos centralizados...");
            
            // PRIMERO: Cargar datos locales para velocidad
            const localProducts = JSON.parse(localStorage.getItem('floristeria_products')) || [];
            const localCategories = JSON.parse(localStorage.getItem('floristeria_categories')) || [];
            const localConfig = JSON.parse(localStorage.getItem('floristeria_config')) || {};
            
            if (localProducts.length > 0) {
                products = localProducts;
                categories = localCategories;
                storeConfig = { ...storeConfig, ...localConfig };
                console.log("üì± Datos locales cargados:", products.length, "productos");
            }
            
            // LUEGO: Cargar datos centralizados desde GitHub
            loadCentralizedData();
        }

        function loadCentralizedData() {
            const dataUrl = 'https://krisarias1990.github.io/Florister-a-Santa-Barbara/data.json';
            
            console.log("üåê Cargando datos centralizados desde:", dataUrl);
            
            fetch(dataUrl + '?v=' + Date.now())
                .then(response => {
                    if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
                    return response.json();
                })
                .then(centralData => {
                    console.log("‚úÖ Datos centralizados recibidos");
                    
                    // Actualizar productos
                    if (centralData.products && Array.isArray(centralData.products)) {
                        products = centralData.products;
                        localStorage.setItem('floristeria_products', JSON.stringify(products));
                    }
                    
                    // Actualizar categor√≠as
                    if (centralData.categories && Array.isArray(centralData.categories)) {
                        categories = centralData.categories;
                        localStorage.setItem('floristeria_categories', JSON.stringify(categories));
                    }
                    
                    // Actualizar configuraci√≥n
                    if (centralData.storeConfig) {
                        storeConfig = { ...storeConfig, ...centralData.storeConfig };
                        localStorage.setItem('floristeria_config', JSON.stringify(storeConfig));
                    }
                    
                    // Actualizar vista si es necesario
                    if (document.getElementById('productsGrid')) {
                        renderProducts(products);
                        updateCategoryFilters();
                    }
                    
                    console.log("üîÑ Datos sincronizados correctamente");
                })
                .catch(error => {
                    console.warn("‚ö†Ô∏è No se pudieron cargar datos centralizados:", error.message);
                    // Continuar con datos locales
                    if (products.length === 0) createDefaultData();
                });
        }

        function createDefaultData() {
            console.log("üîß Creando datos por defecto...");
            
            products = [
                {
                    id: 1,
                    name: "Ramos de Rosas Rojas Premium",
                    nombre: "Ramos de Rosas Rojas Premium",
                    category: "Rosas",
                    categoria: "Rosas",
                    description: "Elegante ramo con 24 rosas rojas frescas, perfecto para aniversarios.",
                    price: 25000,
                    image: "https://images.unsplash.com/photo-1519378058457-4c29a0a2efac?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                    stock: 10
                },
                {
                    id: 2,
                    name: "Centro de Mesa Mixto Grande",
                    nombre: "Centro de Mesa Mixto Grande",
                    category: "Arreglos",
                    categoria: "Arreglos",
                    description: "Colorido centro de mesa para eventos con flores de temporada.",
                    price: 35000,
                    image: "https://images.unsplash.com/photo-1457089328109-e5d9bd499191?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                    stock: 5
                }
            ];
            
            categories = ['Rosas', 'Arreglos', 'Tulipanes', 'Orqu√≠deas', 'Girasoles', 'Lirios'];
            
            localStorage.setItem('floristeria_products', JSON.stringify(products));
            localStorage.setItem('floristeria_categories', JSON.stringify(categories));
            
            console.log("‚úÖ Datos por defecto creados");
        }

        function checkForUpdates() {
            // Solo verificar si el usuario est√° en la p√°gina de cat√°logo
            if (!document.getElementById('productsGrid')) return;
            
            console.log("üîÑ Verificando actualizaciones...");
            
            // Obtener √∫ltima actualizaci√≥n guardada
            const lastUpdate = localStorage.getItem('floristeria_last_update');
            
            // Cargar datos centralizados
            fetch('https://krisarias1990.github.io/Florister-a-Santa-Barbara/data.json?' + Date.now())
                .then(response => response.json())
                .then(data => {
                    const centralUpdate = data.lastUpdated;
                    
                    // Si hay una actualizaci√≥n m√°s reciente
                    if (!lastUpdate || new Date(centralUpdate) > new Date(lastUpdate)) {
                        console.log("üÜï Actualizaci√≥n disponible!");
                        showNotification('üîÑ Actualizando cat√°logo...', 'info');
                        
                        // Recargar datos
                        loadCentralizedData();
                        
                        // Guardar nueva fecha de actualizaci√≥n
                        localStorage.setItem('floristeria_last_update', centralUpdate);
                    }
                })
                .catch(error => {
                    console.log("‚ö†Ô∏è No se pudo verificar actualizaciones:", error.message);
                });
        }

        function setupEventListeners() {
            // Cambio en tipo de entrega
            document.querySelectorAll('input[name="deliveryType"]').forEach(radio => {
                radio.addEventListener('change', toggleAddressField);
            });
            
            // Cerrar modales al hacer clic fuera
            document.getElementById('cartModal').addEventListener('click', function(e) {
                if (e.target === this) closeCart();
            });
            
            document.getElementById('imageModal').addEventListener('click', function(e) {
                if (e.target === this) closeImageModal();
            });
        }

        // ============================================
        // MAPA Y C√ÅLCULO DE DISTANCIA
        // ============================================

        function initMap() {
            // Coordenadas de Santa B√°rbara, Heredia
            storeLocation = [10.0833, -84.1333];
            
            // Crear mapa
            map = L.map('map').setView(storeLocation, 13);
            
            // Agregar capa de OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Agregar marcador de la tienda
            L.marker(storeLocation)
                .addTo(map)
                .bindPopup('Florister√≠a Santa B√°rbara<br>üìç Ubicaci√≥n de la tienda')
                .openPopup();
            
            console.log("üó∫Ô∏è Mapa inicializado correctamente");
        }

        function calculateShippingFromAddress() {
            const address = document.getElementById('deliveryAddress').value.trim();
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked');
            
            // Si es recoger en tienda, costo 0
            if (deliveryType && deliveryType.value === 'pickup') {
                distanceKm = 0;
                updateShippingCost();
                return;
            }
            
            if (!address) {
                distanceKm = 0;
                updateShippingCost();
                return;
            }
            
            // Simular geocodificaci√≥n (en producci√≥n usar√≠as una API como Google Maps)
            // Por ahora, estimamos distancia basada en texto de la direcci√≥n
            
            const addressLower = address.toLowerCase();
            let estimatedDistance = 0;
            
            // Estimaciones por zona
            if (addressLower.includes('santa b√°rbara') || addressLower.includes('santa barbara')) {
                estimatedDistance = 1; // Muy cerca
            } else if (addressLower.includes('heredia centro') || addressLower.includes('heredia')) {
                estimatedDistance = 8;
            } else if (addressLower.includes('san jos√©') || addressLower.includes('san jose')) {
                estimatedDistance = 15;
            } else if (addressLower.includes('alajuela')) {
                estimatedDistance = 20;
            } else if (addressLower.includes('cartago')) {
                estimatedDistance = 25;
            } else {
                // Distancia por defecto para otras √°reas
                estimatedDistance = 10;
            }
            
            distanceKm = estimatedDistance;
            
            // Actualizar mapa con marcador estimado
            if (map) {
                // Limpiar marcadores anteriores
                map.eachLayer(function(layer) {
                    if (layer instanceof L.Marker && layer !== storeLocation) {
                        map.removeLayer(layer);
                    }
                });
                
                // Agregar marcador estimado (un poco al norte de la tienda para ejemplo)
                const estimatedLocation = [storeLocation[0] + 0.05, storeLocation[1] + 0.05];
                L.marker(estimatedLocation)
                    .addTo(map)
                    .bindPopup('üìç Direcci√≥n estimada del cliente')
                    .openPopup();
                
                // Ajustar vista del mapa
                map.fitBounds([storeLocation, estimatedLocation]);
            }
            
            updateShippingCost();
        }

        function updateShippingCost() {
            const shippingCostPerKm = storeConfig.shippingCostPerKm || 650;
            let shippingCost = 0;
            
            if (distanceKm > 0) {
                shippingCost = Math.round(distanceKm * shippingCostPerKm);
                // Redondear a m√∫ltiplo de 100
                shippingCost = Math.ceil(shippingCost / 100) * 100;
            }
            
            // Actualizar en la interfaz
            const shippingElement = document.getElementById('cartShipping');
            const distanceElement = document.getElementById('shippingDistance');
            
            if (shippingElement) {
                shippingElement.textContent = `${storeConfig.currency || '‚Ç°'}${shippingCost.toLocaleString('es-CR')}`;
            }
            
            if (distanceElement) {
                if (distanceKm > 0) {
                    distanceElement.textContent = `(${distanceKm} km √ó ‚Ç°${shippingCostPerKm}/km)`;
                } else {
                    distanceElement.textContent = '';
                }
            }
            
            // Recalcular total
            updateOrderSummary();
        }

        // ============================================
        // CARRUSEL
        // ============================================

        function initCarousel() {
            const carouselImages = [
                {
                    image: "https://images.unsplash.com/photo-1560749003-f4b1e17e2dff?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                    title: "Flores Frescas para Cada Ocasi√≥n",
                    subtitle: "Entregamos felicidad a tu puerta"
                },
                {
                    image: "https://images.unsplash.com/photo-1519378058457-4c29a0a2efac?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                    title: "Ramos Elegantes",
                    subtitle: "Dise√±os personalizados para eventos especiales"
                },
                {
                    image: "https://images.unsplash.com/photo-1457089328109-e5d9bd499191?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                    title: "Centros de Mesa Exclusivos",
                    subtitle: "Decoraci√≥n floral para tu celebraci√≥n"
                }
            ];

            const carouselInner = document.getElementById('carousel-inner');
            const carouselIndicators = document.getElementById('carousel-indicators');

            carouselInner.innerHTML = '';
            carouselIndicators.innerHTML = '';

            carouselImages.forEach((item, index) => {
                // Slide
                const slide = document.createElement('div');
                slide.className = 'carousel-item';
                slide.innerHTML = `
                    <img src="${item.image}" alt="${item.title}" class="carousel-img">
                    <div class="carousel-caption">
                        <h2>${item.title}</h2>
                        <p>${item.subtitle}</p>
                    </div>
                `;
                carouselInner.appendChild(slide);

                // Indicador
                const indicator = document.createElement('button');
                indicator.className = `carousel-indicator ${index === 0 ? 'active' : ''}`;
                indicator.onclick = () => goToSlide(index);
                carouselIndicators.appendChild(indicator);
            });

            updateCarousel();
        }

        function updateCarousel() {
            const carouselInner = document.getElementById('carousel-inner');
            const indicators = document.querySelectorAll('.carousel-indicator');

            carouselInner.style.transform = `translateX(-${currentCarouselSlide * 100}%)`;

            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentCarouselSlide);
            });
        }

        function nextSlide() {
            const slides = document.querySelectorAll('.carousel-item');
            currentCarouselSlide = (currentCarouselSlide + 1) % slides.length;
            updateCarousel();
        }

        function prevSlide() {
            const slides = document.querySelectorAll('.carousel-item');
            currentCarouselSlide = (currentCarouselSlide - 1 + slides.length) % slides.length;
            updateCarousel();
        }

        function goToSlide(index) {
            currentCarouselSlide = index;
            updateCarousel();
        }

        // Auto-avance cada 5 segundos
        setInterval(nextSlide, 5000);

        // ============================================
        // CATEGOR√çAS Y FILTROS
        // ============================================

        function loadCategories() {
            const categoryFilters = document.getElementById('categoryFilters');
            if (!categoryFilters) return;
            
            categoryFilters.innerHTML = '';
            
            // Bot√≥n "Todos"
            const allButton = document.createElement('button');
            allButton.className = 'category-btn active';
            allButton.textContent = 'Todos';
            allButton.onclick = () => filterProducts('all');
            categoryFilters.appendChild(allButton);
            
            // Botones por categor√≠a
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn';
                button.textContent = category;
                button.onclick = () => filterProducts(category);
                categoryFilters.appendChild(button);
            });
        }

        function filterProducts(category) {
            // Actualizar botones activos
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filtrar y mostrar productos
            const filteredProducts = category === 'all' 
                ? products 
                : products.filter(p => p.category === category || p.categoria === category);
            
            renderProducts(filteredProducts);
        }

        function updateCategoryFilters() {
            const categoryFilters = document.getElementById('categoryFilters');
            if (!categoryFilters) return;
            
            categoryFilters.innerHTML = '';
            
            // Bot√≥n "Todos"
            const allButton = document.createElement('button');
            allButton.className = 'category-btn active';
            allButton.textContent = 'Todos';
            allButton.onclick = () => filterProducts('all');
            categoryFilters.appendChild(allButton);
            
            // Botones por categor√≠a
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn';
                button.textContent = category;
                button.onclick = () => filterProducts(category);
                categoryFilters.appendChild(button);
            });
        }

        // ============================================
        // PRODUCTOS
        // ============================================

        function renderProducts(productsToRender) {
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) return;
            
            if (!productsToRender || productsToRender.length === 0) {
                productsGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-leaf" style="font-size: 3rem; margin-bottom: 15px; color: var(--gray-light);"></i>
                        <h3>No hay productos en esta categor√≠a</h3>
                        <p>Prueba con otra categor√≠a o agrega productos desde el panel de administraci√≥n.</p>
                    </div>
                `;
                return;
            }
            
            productsGrid.innerHTML = '';
            
            productsToRender.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                // Usar nombre correcto (compatibilidad con ambos formatos)
                const productName = product.nombre || product.name || 'Producto';
                const productCategory = product.categoria || product.category || 'General';
                const productDescription = product.descripcion || product.description || 'Producto de calidad';
                const productPrice = parseFloat(product.precio || product.price || 0);
                const productImage = product.imagen || product.image || 'https://images.unsplash.com/photo-1560749003-f4b1e17e2dff?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80';
                const productStock = product.stock || 0;
                
                productCard.innerHTML = `
                    <div class="product-image-container">
                        ${productStock < 5 ? '<span class="product-badge">¬°√öltimas unidades!</span>' : ''}
                        <img src="${productImage}" 
                             alt="${productName}" 
                             class="product-image"
                             onclick="openImageModal('${productImage.replace(/'/g, "\\'")}')">
                    </div>
                    <div class="product-info">
                        <span class="product-category">${productCategory}</span>
                        <h3 class="product-title">${productName}</h3>
                        <p class="product-description">${productDescription}</p>
                        <div class="product-price">${storeConfig.currency || '‚Ç°'}${productPrice.toLocaleString('es-CR')}</div>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                            <i class="fas fa-cart-plus"></i>
                            Agregar al Carrito
                        </button>
                    </div>
                `;
                
                productsGrid.appendChild(productCard);
            });
        }

        function loadProducts() {
            // Obtener productos desde localStorage
            products = JSON.parse(localStorage.getItem('floristeria_products')) || [];
            
            if (products.length === 0) {
                createDefaultData();
            }
            
            renderProducts(products);
        }

        // ============================================
        // VISTA AMPLIADA DE IM√ÅGENES
        // ============================================

        function openImageModal(imageUrl) {
            document.getElementById('modalImage').src = imageUrl;
            document.getElementById('imageModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // ============================================
        // CARRITO DE COMPRAS
        // ============================================

        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelector('.cart-count').textContent = count;
        }

        function addToCart(productId) {
            const product = products.find(p => p.id == productId);
            if (!product) {
                showNotification('Producto no encontrado', 'error');
                return;
            }

            const existingItem = cart.find(item => item.id == productId);
            
            if (existingItem) {
                if (existingItem.quantity >= (product.stock || 99)) {
                    showNotification('No hay m√°s stock disponible', 'warning');
                    return;
                }
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.nombre || product.name,
                    price: parseFloat(product.precio || product.price || 0),
                    image: product.image || product.imagen,
                    quantity: 1
                });
            }

            localStorage.setItem('floristeria_cart', JSON.stringify(cart));
            updateCartCount();
            showNotification(`${product.nombre || product.name} agregado al carrito`);
            
            // Animaci√≥n en el bot√≥n
            const button = event.target.closest('.add-to-cart-btn');
            button.classList.add('added');
            button.innerHTML = '<i class="fas fa-check"></i> Agregado';
            setTimeout(() => {
                button.classList.remove('added');
                button.innerHTML = '<i class="fas fa-cart-plus"></i> Agregar al Carrito';
            }, 1500);
        }

        function openCart() {
            if (cart.length === 0) {
                showNotification('Tu carrito est√° vac√≠o', 'warning');
                return;
            }
            
            document.getElementById('cartModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            loadCartItems();
        }

        function closeCart() {
            document.getElementById('cartModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function toggleAddressField() {
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked');
            const addressField = document.getElementById('addressField');
            const mapElement = document.getElementById('map');
            const mapInstructions = document.getElementById('mapInstructions');
            
            if (deliveryType.value === 'pickup') {
                addressField.style.display = 'none';
                document.getElementById('deliveryAddress').required = false;
                if (mapElement) mapElement.style.display = 'none';
                if (mapInstructions) mapInstructions.style.display = 'none';
                distanceKm = 0;
            } else {
                addressField.style.display = 'block';
                document.getElementById('deliveryAddress').required = true;
                if (mapElement) mapElement.style.display = 'block';
                if (mapInstructions) mapInstructions.style.display = 'block';
                calculateShippingFromAddress();
            }
            
            updateShippingCost();
        }

        function loadCartItems() {
            const container = document.getElementById('cartItemsContainer');
            const cartSubtotal = document.getElementById('cartSubtotal');
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="cart-empty">
                        <i class="fas fa-shopping-cart" style="font-size: 4rem; color: var(--gray-light); margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--gray); margin-bottom: 0.5rem;">Tu carrito est√° vac√≠o</h3>
                        <p style="color: var(--gray); margin-bottom: 1.5rem;">Agrega algunos productos para comenzar</p>
                        <button class="btn btn-primary" onclick="closeCart()" style="padding: 10px 20px;">
                            <i class="fas fa-store"></i> Explorar Cat√°logo
                        </button>
                    </div>
                `;
                cartSubtotal.textContent = `${storeConfig.currency || '‚Ç°'}0`;
                document.getElementById('cartShipping').textContent = `${storeConfig.currency || '‚Ç°'}0`;
                document.getElementById('cartTotal').textContent = `${storeConfig.currency || '‚Ç°'}0`;
                return;
            }
            
            let html = '<div class="cart-items">';
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemPrice = parseFloat(item.price) || 0;
                const itemQuantity = parseInt(item.quantity) || 1;
                const itemTotal = itemPrice * itemQuantity;
                subtotal += itemTotal;
                
                html += `
                    <div class="cart-item">
                        <img src="${item.image || 'https://images.unsplash.com/photo-1560749003-f4b1e17e2dff?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80'}" 
                             alt="${item.name}" class="cart-item-image">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-price">${storeConfig.currency || '‚Ç°'}${itemPrice.toLocaleString('es-CR')} c/u</div>
                        </div>
                        <div class="cart-item-actions">
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="item-quantity">${itemQuantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="remove-item-btn" onclick="removeFromCart(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            // Actualizar subtotal
            cartSubtotal.textContent = `${storeConfig.currency || '‚Ç°'}${subtotal.toLocaleString('es-CR')}`;
            
            // Calcular env√≠o
            calculateShippingFromAddress();
        }

        function updateOrderSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (parseFloat(item.price) * (item.quantity || 1)), 0);
            const shippingCostPerKm = storeConfig.shippingCostPerKm || 650;
            let shippingCost = 0;
            
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked');
            if (deliveryType && deliveryType.value === 'delivery' && distanceKm > 0) {
                shippingCost = Math.round(distanceKm * shippingCostPerKm);
                shippingCost = Math.ceil(shippingCost / 100) * 100;
            }
            
            const total = subtotal + shippingCost;
            
            document.getElementById('cartSubtotal').textContent = `${storeConfig.currency || '‚Ç°'}${subtotal.toLocaleString('es-CR')}`;
            document.getElementById('cartShipping').textContent = `${storeConfig.currency || '‚Ç°'}${shippingCost.toLocaleString('es-CR')}`;
            document.getElementById('cartTotal').textContent = `${storeConfig.currency || '‚Ç°'}${total.toLocaleString('es-CR')}`;
            
            const distanceElement = document.getElementById('shippingDistance');
            if (distanceElement) {
                if (distanceKm > 0 && deliveryType && deliveryType.value === 'delivery') {
                    distanceElement.textContent = `(${distanceKm} km √ó ‚Ç°${shippingCostPerKm}/km)`;
                } else {
                    distanceElement.textContent = '';
                }
            }
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id == productId);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                cart = cart.filter(item => item.id != productId);
                showNotification('Producto eliminado del carrito');
            }
            
            localStorage.setItem('floristeria_cart', JSON.stringify(cart));
            updateCartCount();
            loadCartItems();
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id != productId);
            localStorage.setItem('floristeria_cart', JSON.stringify(cart));
            updateCartCount();
            loadCartItems();
            showNotification('Producto eliminado del carrito');
        }

        function clearCart() {
            if (cart.length === 0) {
                showNotification('El carrito ya est√° vac√≠o', 'warning');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que deseas vaciar todo el carrito?')) {
                cart = [];
                localStorage.removeItem('floristeria_cart');
                updateCartCount();
                loadCartItems();
                showNotification('Carrito vaciado correctamente');
            }
        }

        // ============================================
        // FORMULARIO DE PEDIDO
        // ============================================

        function selectPayment(method) {
            selectedPayment = method;
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.closest('.payment-method').classList.add('selected');
        }

        // ============================================
        // WHATSAPP INTEGRATION
        // ============================================

        function sendWhatsAppOrder() {
            // Validar formulario
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked').value;
            const address = document.getElementById('deliveryAddress').value.trim();
            const date = document.getElementById('deliveryDate').value;
            const time = document.getElementById('deliveryTime').value;
            const notes = document.getElementById('orderNotes').value.trim();
            
            // Validaciones
            if (!name || !phone || (deliveryType === 'delivery' && !address) || !date || !time) {
                showNotification('Por favor complete todos los campos requeridos (*)', 'error');
                return;
            }
            
            if (cart.length === 0) {
                showNotification('Tu carrito est√° vac√≠o', 'error');
                return;
            }
            
            if (!selectedPayment) {
                showNotification('Por favor seleccione un m√©todo de pago', 'error');
                return;
            }
            
            // Generar n√∫mero de pedido
            const orderNumber = 'PED-' + new Date().getTime().toString().slice(-8);
            const orderDate = new Date().toLocaleDateString('es-ES');
            const orderTime = new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            
            // Construir mensaje
            let message = `${storeConfig.whatsappMessage}\n\n`;
            message += `üõçÔ∏è *DETALLE DEL PEDIDO*\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `üì¶ N√∫mero de pedido: ${orderNumber}\n`;
            message += `üóìÔ∏è Fecha del pedido: ${orderDate}\n`;
            message += `üïê Hora del pedido: ${orderTime}\n\n`;
            
            message += `üë§ *INFORMACI√ìN DEL CLIENTE*\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `‚Ä¢ Nombre: ${name}\n`;
            message += `‚Ä¢ Tel√©fono: ${phone}\n`;
            message += `‚Ä¢ Entrega: ${deliveryType === 'delivery' ? 'A domicilio' : 'Recoger en tienda'}\n`;
            
            if (deliveryType === 'delivery') {
                message += `‚Ä¢ Direcci√≥n: ${address}\n`;
                message += `‚Ä¢ Distancia estimada: ${distanceKm} km\n`;
            }
            
            message += `‚Ä¢ Fecha de entrega: ${new Date(date).toLocaleDateString('es-ES')}\n`;
            message += `‚Ä¢ Horario: ${time}\n\n`;

            message += `üìù *PRODUCTOS SOLICITADOS*\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            
            cart.forEach((item, index) => {
                message += `${index + 1}. *${item.name}*\n`;
                message += `   Cantidad: ${item.quantity}\n`;
                message += `   Precio unitario: ${storeConfig.currency || '‚Ç°'}${(parseFloat(item.price) || 0).toLocaleString('es-CR')}\n`;
                message += `   Subtotal: ${storeConfig.currency || '‚Ç°'}${((parseFloat(item.price) || 0) * item.quantity).toLocaleString('es-CR')}\n`;
                
                if (item.image && item.image.startsWith('http')) {
                    message += `   üëÅÔ∏è *Ver producto:* ${item.image}\n`;
                }
                message += `\n`;
            });
            
            // Secci√≥n de im√°genes
            if (cart.some(item => item.image)) {
                message += `\nüñºÔ∏è *IM√ÅGENES DE LOS PRODUCTOS:*\n`;
                message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                
                cart.forEach((item, index) => {
                    if (item.image) {
                        if (item.image.startsWith('http') || item.image.startsWith('data:image')) {
                            message += `üì∏ *${item.name}:*\n`;
                            message += `${item.image}\n\n`;
                        }
                    }
                });
            }
            
            message += `üí∞ *RESUMEN DE PAGO*\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            
            const subtotal = cart.reduce((sum, item) => sum + ((parseFloat(item.price) || 0) * item.quantity), 0);
            const shippingCostPerKm = storeConfig.shippingCostPerKm || 650;
            let shipping = 0;
            
            if (deliveryType === 'delivery' && distanceKm > 0) {
                shipping = Math.round(distanceKm * shippingCostPerKm);
                shipping = Math.ceil(shipping / 100) * 100;
            }
            
            const total = subtotal + shipping;
            
            message += `‚Ä¢ Subtotal: ${storeConfig.currency || '‚Ç°'}${subtotal.toLocaleString('es-CR')}\n`;
            if (shipping > 0) {
                message += `‚Ä¢ Costo de env√≠o: ${storeConfig.currency || '‚Ç°'}${shipping.toLocaleString('es-CR')} (${distanceKm} km √ó ‚Ç°${shippingCostPerKm}/km)\n`;
            } else {
                message += `‚Ä¢ Costo de env√≠o: ${storeConfig.currency || '‚Ç°'}0 (Recoger en tienda)\n`;
            }
            message += `‚Ä¢ *TOTAL A PAGAR: ${storeConfig.currency || '‚Ç°'}${total.toLocaleString('es-CR')}*\n\n`;
            
            message += `üí≥ *M√âTODO DE PAGO*\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `‚Ä¢ ${getPaymentMethodName(selectedPayment)}\n\n`;
            
            if (selectedPayment === 'sinpe') {
                message += `üì± *DATOS PARA SINPE M√ìVIL*\n`;
                message += `‚Ä¢ Tel√©fono: 8605-3613\n`;
                message += `‚Ä¢ Nombre: Florister√≠a Santa B√°rbara\n\n`;
            }
            
            if (selectedPayment === 'transferencia') {
                message += `üè¶ *DATOS PARA TRANSFERENCIA*\n`;
                message += `‚Ä¢ Banco: BAC San Jos√©\n`;
                message += `‚Ä¢ Cuenta: 123456789\n`;
                message += `‚Ä¢ Nombre: Florister√≠a Santa B√°rbara S.A.\n\n`;
            }
            
            if (notes) {
                message += `üìã *NOTAS ADICIONALES*\n`;
                message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                message += `${notes}\n\n`;
            }
            
            message += `‚úÖ *CONFIRMACI√ìN*\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `Por favor confirme este pedido para proceder. Nos comunicaremos en menos de 30 minutos.\n\n`;
            message += `¬°Gracias por elegir Florister√≠a Santa B√°rbara! üíê`;
            
            // Codificar mensaje para URL
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${storeConfig.phoneNumber}?text=${encodedMessage}`;
            
            // Guardar pedido en historial
            saveOrderToHistory({
                number: orderNumber,
                customerName: name,
                customerPhone: phone,
                deliveryType: deliveryType,
                address: address,
                distanceKm: distanceKm,
                date: date,
                time: time,
                paymentMethod: selectedPayment,
                items: cart.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    price: parseFloat(item.price) || 0,
                    image: item.image
                })),
                subtotal: subtotal,
                shipping: shipping,
                total: total,
                notes: notes,
                timestamp: new Date().toISOString()
            });
            
            // Limpiar carrito
            cart = [];
            localStorage.removeItem('floristeria_cart');
            updateCartCount();
            closeCart();
            
            // Abrir WhatsApp
            window.open(whatsappUrl, '_blank');
            
            // Mostrar confirmaci√≥n
            showNotification('¬°Pedido enviado por WhatsApp! Revisa tu chat para confirmar.', 'success');
        }

        function getPaymentMethodName(method) {
            const methods = {
                'sinpe': 'SINPE M√≥vil',
                'efectivo': 'Efectivo',
                'tarjeta': 'Tarjeta de cr√©dito/d√©bito',
                'transferencia': 'Transferencia bancaria'
            };
            return methods[method] || method;
        }

        function saveOrderToHistory(order) {
            let orders = JSON.parse(localStorage.getItem('floristeria_orders')) || [];
            orders.push(order);
            localStorage.setItem('floristeria_orders', JSON.stringify(orders));
        }

        // ============================================
        // NOTIFICACIONES
        // ============================================

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type);
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ============================================
        // FUNCIONES GLOBALES
        // ============================================

        window.openCart = openCart;
        window.closeCart = closeCart;
        window.addToCart = addToCart;
        window.updateQuantity = updateQuantity;
        window.removeFromCart = removeFromCart;
        window.openImageModal = openImageModal;
        window.closeImageModal = closeImageModal;
        window.selectPayment = selectPayment;
        window.sendWhatsAppOrder = sendWhatsAppOrder;
        window.prevSlide = prevSlide;
        window.nextSlide = nextSlide;
        window.goToSlide = goToSlide;
        window.filterProducts = filterProducts;
        window.calculateShippingFromAddress = calculateShippingFromAddress;
        window.toggleAddressField = toggleAddressField;
    </script>
</body>
</html>
